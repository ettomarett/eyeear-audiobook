version: "3.9"

services:
  eyeear-backend:
    image: eyeear-audiobook:latest
    container_name: eyeear-backend
    restart: always
    environment:
      - NODE_ENV=production
      - PORT=3003
      # Add other environment variables as needed
      # - GCS_BUCKET_NAME=your-bucket-name
    volumes:
      # Persist data, output, and logs (using bind mounts for easier access)
      - ./data:/app/data
      - ./output:/app/output
      - ./logs:/app/logs
      - ./temp:/app/temp
      # Google credentials are stored in ./data/google_credentials.json
    networks:
      - traefik-network
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=traefik-network"
      # Main router
      - "traefik.http.routers.eyeear.rule=Host(`eyeear.clueleak.com`)"
      - "traefik.http.routers.eyeear.entrypoints=websecure"
      - "traefik.http.routers.eyeear.tls.certresolver=cf"
      - "traefik.http.routers.eyeear.priority=900"
      - "traefik.http.routers.eyeear.service=eyeear"
      - "traefik.http.services.eyeear.loadbalancer.server.port=3003"
      # Health check router
      - "traefik.http.routers.eyeear-hz.rule=Host(`eyeear.clueleak.com`) && Path(`/api/health`)"
      - "traefik.http.routers.eyeear-hz.entrypoints=websecure"
      - "traefik.http.routers.eyeear-hz.tls.certresolver=cf"
      - "traefik.http.routers.eyeear-hz.priority=1000"
      - "traefik.http.routers.eyeear-hz.service=eyeear-hz"
      - "traefik.http.services.eyeear-hz.loadbalancer.server.port=3003"

# Using bind mounts instead of named volumes for easier file access
# volumes:
#   eyeear_data:
#   eyeear_output:
#   eyeear_logs:
#   eyeear_temp:

networks:
  traefik-network:
    external: true

